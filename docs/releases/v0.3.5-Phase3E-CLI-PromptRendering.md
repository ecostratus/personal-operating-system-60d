# v0.3.5 — Phase 3E: Combined CLI + Prompt Rendering

## Release Summary
- Combined runner to generate outreach + resume prompts
- VS Code tasks for env setup and venv-backed runs (combined/individual)
- Deterministic prompt renderer and enriched context wiring
- Sample context support; timestamped outputs under `output/`
- Tests surface in VS Code Problems; docs updated with checklist & quick links

Quickstart: [Progress‑to‑Launch Checklist & Timeline](../progress_to_launch_checklist_timeline.md)

## Overview

This release introduces a unified CLI workflow for generating outreach and resume prompts using enriched job context and user‑specific configuration. It finalizes the prompt‑rendering pipeline and adds deterministic output saving with timestamps.

## Highlights

- CLI support for outreach and resume prompt generation
- Deterministic prompt renderer
- User‑specific context file support
- Timestamped output files
- Enrichment toggle respected end‑to‑end
- Updated docs and tests

## Changes

- Added CLI flags (`--context`, `--output-dir`, `--prompt`, `--no-sources`)
- Added deterministic `render_prompt()`
- Wired enriched context into both prompt flows
- Added config paths for user context + output directories
- Added sample context files
- Added renderer + enriched flow tests

## Upgrade Notes

- No breaking changes
- To disable enrichment, set `"ENRICHMENT_ENABLED": false` in your environment config
- To use custom context, pass `--context path/to/file.json`

## Next

- Template variants by seniority/domain/stack
- Behavior‑level logging and metrics
- Snapshot tests for rendered prompts
- User‑specific enrichment overrides

---

## Setup

Use the venv‑backed VS Code tasks or terminal commands.

### VS Code
- Run: "Setup Python env" — creates `.venv`, installs dev + module requirements
- Then run:
	- "Run: Combined Prompts (venv)" or
	- "Run: Combined Prompts (venv, no-sources)" for sample inputs

### Terminal
```bash
python3 -m venv .venv
. .venv/bin/activate
python -m pip install -U pip pytest
python -m pip install \
	-r automation/outreach/scripts/requirements.txt \
	-r automation/resume-tailoring/scripts/requirements.txt \
	-r automation/job-discovery/scripts/requirements.txt
```

### Quickstart (commands)
```bash
# Setup
python3 -m venv .venv && . .venv/bin/activate
python -m pip install -U pip pytest
python -m pip install -r automation/outreach/scripts/requirements.txt -r automation/resume-tailoring/scripts/requirements.txt -r automation/job-discovery/scripts/requirements.txt

# Generate both prompts (sample inputs)
./.venv/bin/python automation/common/run_prompts.py \
	--outreach-context config/outreach_context.sample.json \
	--outreach-output-dir output/outreach \
	--resume-context config/resume_context.sample.json \
	--resume-output-dir output/resume \
	--no-sources
```

#### VS Code Tasks (names)
- Setup Python env
- Run: Combined Prompts (venv)
- Run: Combined Prompts (venv, no-sources)
- Run: Outreach Prompt (venv)
- Run: Outreach Prompt (venv, no-sources)
- Run: Resume Prompt (venv)
- Run: Resume Prompt (venv, no-sources)
- Run Python tests

## How to Run

### Combined (venv)
```bash
./.venv/bin/python automation/common/run_prompts.py \
	--outreach-context config/outreach_context.sample.json \
	--outreach-output-dir output/outreach \
	--resume-context config/resume_context.sample.json \
	--resume-output-dir output/resume
```

### Combined (venv, no-sources)
```bash
./.venv/bin/python automation/common/run_prompts.py \
	--outreach-context config/outreach_context.sample.json \
	--outreach-output-dir output/outreach \
	--resume-context config/resume_context.sample.json \
	--resume-output-dir output/resume \
	--no-sources
```

### Individual (venv, no-sources)
```bash
# Outreach
./.venv/bin/python automation/outreach/scripts/outreach_generator_v1.py \
	--context config/outreach_context.sample.json \
	--output-dir output/outreach \
	--prompt prompts/outreach/outreach_prompt_v1.md \
	--no-sources

# Resume
./.venv/bin/python automation/resume-tailoring/scripts/resume_tailor_v1.py \
	--context config/resume_context.sample.json \
	--output-dir output/resume \
	--prompt prompts/resume/resume_tailor_prompt_v1.md \
	--no-sources
```

## Tests
Run with VS Code task "Run Python tests" (errors surface in Problems), or via terminal:
```bash
./.venv/bin/python -m pytest -q --tb=short
./.venv/bin/python -m pytest tests/job_discovery_tests.py -q --tb=short
./.venv/bin/python -m pytest tests/outreach_flow_tests.py -q --tb=short
./.venv/bin/python -m pytest tests/resume_tailoring_tests.py -q --tb=short
```

## Acceptance Criteria
- "Setup Python env" runs cleanly and installs requirements
- Combined runner executes and writes both prompts under `output/...`
- Test tasks populate VS Code Problems via matcher
- README and docs link to v0.3.5 and checklist

## Assets
- Prompt outputs: `output/outreach/` and `output/resume/` (timestamped Markdown)
- Test diagnostics: Problems panel entries when running VS Code test tasks

## Compatibility
- Tested with Python 3.8+; recommend 3.10 or newer for best tooling support

## Links
- Combined runner: [automation/common/run_prompts.py](../automation/common/run_prompts.py)
- Renderer: [automation/common/prompt_renderer.py](../automation/common/prompt_renderer.py)
- Enrichment: [automation/job-discovery/scripts/enrichment_transforms.py](../automation/job-discovery/scripts/enrichment_transforms.py)
- Outreach script: [automation/outreach/scripts/outreach_generator_v1.py](../automation/outreach/scripts/outreach_generator_v1.py)
- Resume script: [automation/resume-tailoring/scripts/resume_tailor_v1.py](../automation/resume-tailoring/scripts/resume_tailor_v1.py)
- Checklist & Timeline: [docs/progress_to_launch_checklist_timeline.md](../progress_to_launch_checklist_timeline.md)
- Tasks: [.vscode/tasks.json](../../.vscode/tasks.json)
- Sample env: [config/env.sample.json](../../config/env.sample.json)

## Known Issues
- Direct REPL imports of enrichment functions can fail due to path semantics; use CLI scripts or the combined runner
- Local pytest requires dev tools; install via "Setup Python env" or terminal commands above

## Recommendations
- Prefer venv-backed tasks for consistent interpreter and dependencies
- If tasks don’t appear after editing, run “Developer: Reload Window” in VS Code
- Ensure output directories exist (e.g., `output/outreach`, `output/resume`) before first run
- Use `--no-sources` for quick dry runs using sample inputs

## Troubleshooting
- Malformed tasks.json errors (e.g., "task neither specifies a command nor a dependsOn" or "a task must provide a label property"): ensure every task has `label`, `type`, `command`, and `args`; avoid nesting a `version`/`tasks` block inside another task; fix any missing commas.
- Missing venv interpreter (`.venv/bin/python` not found): run the VS Code task "Setup Python env" or use the terminal setup commands.
- Missing pytest (`No module named pytest`): run "Install dev requirements" or `python -m pip install pytest` inside the venv.
- Problem matcher error ("description can't be converted into a problem matcher"): use the provided matcher in tasks (`fileLocation: "relative"`, pattern `^(.*):(\\d+): (.*)$`).
- REPL import failures for enrichment: run the CLI scripts or combined runner rather than importing modules directly in a REPL.

## FAQ
- Where are outputs saved? In `output/outreach/` and `output/resume/` with timestamped filenames.
- How do I disable enrichment? Set `ENRICHMENT_ENABLED=false` in your environment config.
- How do I use my own context? Pass `--context path/to/your.json` to the outreach/resume scripts or set the combined runner flags.
- How do I change templates? Use `--prompt` to point to a custom Markdown template.
- Why do imports fail in REPL? The directory layout prefers script execution; use the runners to ensure paths are set correctly.
- Can I run under system Python? Yes, but the venv tasks are recommended for consistent dependencies.

## Appendix
- Commands cheat sheet:
	- Setup: see Quickstart commands block above
	- Combined run (sample): see "Combined (venv, no-sources)"
	- Individual runs (sample): see "Individual (venv, no-sources)"
- Key files:
	- Tasks config: [.vscode/tasks.json](../../.vscode/tasks.json)
	- Combined runner: [automation/common/run_prompts.py](../automation/common/run_prompts.py)
	- Outreach script: [automation/outreach/scripts/outreach_generator_v1.py](../automation/outreach/scripts/outreach_generator_v1.py)
	- Resume script: [automation/resume-tailoring/scripts/resume_tailor_v1.py](../automation/resume-tailoring/scripts/resume_tailor_v1.py)
	- Checklist: [docs/progress_to_launch_checklist_timeline.md](../progress_to_launch_checklist_timeline.md)
	- Env sample: [config/env.sample.json](../../config/env.sample.json)
